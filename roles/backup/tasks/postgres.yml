---
- name: Create .pgpass file
  copy:
    content: "{{ db_host }}:{{ db_port }}:{{ db_name }}:{{ db_user }}:{{ vault_db_password }}"
    dest: "{{ app_base_path }}/.pgpass"
    owner: "{{ app_user }}"
    group: "{{ app_user }}"
    mode: '0600'

- name: Check if pg_dump is available
  command: which pg_dump
  register: pg_dump_check
  changed_when: false
  failed_when: false

- name: Fail if pg_dump not installed
  fail:
    msg: "pg_dump not found. Please install postgresql-client manually."
  when: pg_dump_check.rc != 0
